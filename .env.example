# ===================================
# EFSORA CUSTOMER PORTAL - ENVIRONMENT VARIABLES
# ===================================
# Copy this file to .env and fill in the values
# NEVER commit .env to version control
#
# For Docker-based development, all services read from this single .env file
# ===================================

# ===================================
# SHARED INFRASTRUCTURE
# ===================================

# PostgreSQL Database Server (used by postgres container)
# These set the superuser credentials when PostgreSQL initializes
POSTGRES_DB=app_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres  # Superuser password for 'postgres' user
POSTGRES_PORT=5432

# Weaviate Vector Database
WEAVIATE_PORT=8080
WEAVIATE_GRPC_PORT=50051

# ===================================
# BACKEND SERVICE (Express + TypeScript)
# ===================================

# Server Configuration
BACKEND_PORT=3000
NODE_ENV=development

# Database Connection
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://backend_user:backend_password@postgres:5432/backend_db

# Database Connection Details (for PostgreSQL client tools in backend)
# These are used by psql commands in entrypoint scripts
DB_HOST=postgres
DB_USER=backend_user           # Application database user (not superuser)
DB_NAME=backend_db
PGPASSWORD=backend_password    # Password for backend_user (used by psql client)

# JWT Authentication
# IMPORTANT: Generate a secure random secret (min 32 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
# Or: openssl rand -base64 32
JWT_SECRET=your-secure-jwt-secret-min-32-chars-change-this

# Inter-Service Communication
AI_SERVICE_URL=http://ai-service:8000

# Observability - Tracing (OpenTelemetry)
ENABLE_TRACING=true
TRACING_SAMPLE_RATE=1.0
OTEL_SERVICE_NAME=backend-api
# Optional: Send traces to external collector (Jaeger, Tempo, etc.)
# If not set, traces will be logged to console via ConsoleSpanExporter
# OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318/v1/traces

# Observability - Metrics (Prometheus)
METRICS_ENABLED=true

# Logging Configuration
LOG_LEVEL=debug
LOGGER_PRETTY=true

# ===================================
# FRONTEND SERVICE (React + Vite)
# ===================================

# Frontend Server Port
FRONTEND_PORT=5173

# API Endpoint (used by frontend to call backend)
# For Docker development: Use host machine URL (localhost:3000)
# For production: Use empty string "" to use relative URLs (nginx proxy)
VITE_API_URL=http://localhost:3000

# Node Environment
VITE_NODE_ENV=development

# ===================================
# AI SERVICE (FastAPI + Python)
# ===================================

# Environment (dev/staging/prod)
ENV=dev

# Application Metadata
APP_NAME=fastapi-backend
APP_VERSION=0.1.0

# Logging
AI_LOG_LEVEL=INFO
AI_LOG_FORMAT=json

# PostgreSQL Connection (for AI service)
POSTGRES_HOST=postgres
# POSTGRES_PORT, POSTGRES_DB, POSTGRES_USER, POSTGRES_PASSWORD are shared above

# Database Schemas
AI_SCHEMA=ai_schema
BACKEND_SCHEMA=backend_schema

# Weaviate Configuration
WEAVIATE_HOST=weaviate
# WEAVIATE_PORT and WEAVIATE_GRPC_PORT are shared above
WEAVIATE_COLLECTION_NAME=EFSORA_CustomerPortal

# AI Service Port
AI_SERVICE_PORT=8000

# Data Directories (Docker volumes)
DATA_DIR=/app/data/
OUTPUT_DIR=/app/output/

# AI Model Configuration
SEMANTIC_MAX_TOKENS=512
EMBED_MODEL=amazon.titan-embed-text-v2:0
LLM_MODEL=global.anthropic.claude-sonnet-4-20250514-v1:0

# AWS Bedrock Configuration
BEDROCK_REGION=us-east-1

# AWS Credentials (for Bedrock access)
# IMPORTANT: NEVER commit actual credentials
# Get these from AWS IAM Console
AWS_ACCESS_KEY_ID=your_aws_access_key_id_here
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key_here

# ===================================
# TEST ENVIRONMENT (Cypress E2E)
# ===================================

# Cypress Test Configuration
# For Docker: Use service names instead of localhost
CYPRESS_baseUrl=http://frontend:5173
CYPRESS_apiUrl=http://backend:3000/api

# Test User Credentials (should be seeded in test database)
TEST_USER_EMAIL=testuser.dev@example.com
TEST_USER_PASSWORD=DevPass123!
TEST_ADMIN_EMAIL=admin.dev@example.com
TEST_ADMIN_PASSWORD=DevAdminPass123!

# Qase.io Test Management (Optional)
# Sign up at https://qase.io/ to get these
QASE_API_TOKEN=your_qase_api_token_here
QASE_PROJECT_CODE=ECP

# ===================================
# SECURITY NOTES
# ===================================
# 1. Always use strong, unique passwords for databases
# 2. Generate unique JWT secrets per environment (dev/staging/prod)
# 3. Rotate AWS credentials regularly
# 4. Never commit .env files to version control
# 5. Use different credentials for production vs development
# 6. Consider using Docker secrets for production deployments
#
# ===================================
# DOCKER COMPOSE USAGE
# ===================================
# Start all services in development mode:
#   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
#
# Start services and view logs:
#   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up
#
# Stop all services:
#   docker-compose down
#
# Rebuild after dependency changes:
#   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d --build
# ===================================
